define(["jquery","core/config","core/log","mod_tracker/bootstrap-select"],function(a,b,c,d){var e={init:function(){a(".tracker-issue-edit-handle").bind("click",this.load_change_form),a("#modal-status-save").bind("click",this.submit_change_form),a(".tracker-quick-solve-buttons").bind("click",this.solve_issue),a("#tracker-quick-find-input").bind("change",this.quick_find),c.debug("AMD Tracker List initialized")},load_change_form:function(){var c=a(this),d='<div class="centered"><center><img id="detail-waiter" src="';d+=b.wwwroot+'/pix/i/ajaxloader.gif" /></center></div>',a("#issuelist-edit-inner-form").html(d);var e=c.attr("id").replace(/issue-edit-(.*?)-handle-/,""),f=c.attr("data-mode"),g=c.attr("data-context"),h=b.wwwroot+"/mod/tracker/ajax/service.php";h+="?what=getmodalform",h+="&mode="+f,h+="&id="+e,h+="&ctx="+g,a.get(h,function(b){a("#issuelist-edit-inner-form").html(b),a("#modal-status-save").attr("data-issue",e),a("#modal-status-save").attr("data-purpose",f),a(".selectpicker").selectpicker()},"html")},submit_change_form:function(){var c=a(this),d=c.attr("data-issue"),f=c.attr("data-purpose"),g=b.wwwroot+"/mod/tracker/ajax/service.php";g+="?what=update"+f,g+="&id="+d;var h="#"+f+"-select-"+d;g+="&"+f+"="+a(h).val(),a.get(g,function(b){if("success"===b.result){if("status"==f){var c="status-"+e.get_status_code(b.oldvalue);a(".issue-list-status-"+d).removeClass(c);var g="status-"+e.get_status_code(b.newvalue);a(".issue-list-status-"+d).addClass(g)}a("#tracker-"+f+"-"+d).html(b.newlabel),a("#issuelist-edit-form").modal("hide")}},"json")},get_status_code:function(a){var b=["posted","open","resolving","waiting","resolved","abandonned","transfered","testing","validated","published"];return b[a]},solve_issue:function(){var c=a(this),d=c.attr("id").replace("resolve-",""),e=c.attr("data-cmid"),f=b.wwwroot+"/mod/tracker/view.php?id="+e;f+="&view=view",f+="&screen=mytickets",f+="&what=solve",f+="&issueid="+d,f+="&sesskey="+b.sesskey,window.location=f},quick_find:function(){a("#id-quick-find-form").submit()}};return e});