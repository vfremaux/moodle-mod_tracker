define(["jquery","core/config","core/log","mod_tracker/bootstrap-select"],function(t,e,s,a){var i={init:function(){t(".tracker-issue-edit-handle").bind("click",this.load_change_form),t("#modal-status-save").bind("click",this.submit_change_form),t(".tracker-quick-solve-buttons").bind("click",this.solve_issue),s.debug("AMD Tracker List initialized")},load_change_form:function(){var s=t(this),a='<div class="centered"><center><img id="detail-waiter" src="';a+=e.wwwroot+'/pix/i/ajaxloader.gif" /></center></div>',t("#issuelist-edit-inner-form").html(a);var i=s.attr("id").replace(/issue-edit-(.*?)-handle-/,""),r=s.attr("data-mode"),o=s.attr("data-context"),d=e.wwwroot+"/mod/tracker/ajax/service.php";d+="?what=getmodalform",d+="&mode="+r,d+="&id="+i,d+="&ctx="+o,t.get(d,function(e){t("#issuelist-edit-inner-form").html(e),t("#modal-status-save").attr("data-issue",i),t("#modal-status-save").attr("data-purpose",r),t(".selectpicker").selectpicker()},"html")},submit_change_form:function(){var s=t(this),a=s.attr("data-issue"),r=s.attr("data-purpose"),o=e.wwwroot+"/mod/tracker/ajax/service.php";o+="?what=update"+r,o+="&id="+a,o+="&"+r+"="+t("#"+r+"-select-"+a).val(),t.get(o,function(e){if("success"===e.result){if("status"==r){var s="status-"+i.get_status_code(e.oldvalue);t(".issue-list-status-"+a).removeClass(s);var o="status-"+i.get_status_code(e.newvalue);t(".issue-list-status-"+a).addClass(o)}t("#tracker-"+r+"-"+a).html(e.newlabel),t("#issuelist-edit-form").modal("hide")}},"json")},get_status_code:function(t){return["posted","open","resolving","waiting","resolved","abandonned","transfered","testing","validated","published"][t]},solve_issue:function(){var s=t(this),a=s.attr("id").replace("resolve-",""),i=s.attr("data-cmid"),r=e.wwwroot+"/mod/tracker/view.php?id="+i;r+="&view=view",r+="&screen=mytickets",r+="&what=solve",r+="&issueid="+a,r+="&sesskey="+e.sesskey,window.location=r}};return i});